### The Design Philosophy of the DARPA Internet Protocols （综述探讨性）

1. DARPA互联网架构的最高目标是开发一种有效的技术，用于现有互连网络的多路复用利用。因特网的基本结构:一种分组交换通信设施，其中许多可区分的网络使用称为网关的分组通信处理器连接在一起，网关实现了一种存储和转发分组转发算法。
2. 提出网络体系构建的更详细的七条定义，下面分组解读。

3. 面对失败的生存能力：
- 这方面最重要的目标是，即使网络和网关失效，互联网也应该继续提供通信服务，即发生中断通信实体能继续通信而无需重新建立。该体系结构中假设同步永远不丢失，除非没有可以实现任何通信的物理路径。换句话说，在传输的顶部只有完全分区(total partition)故障。该体系结构完全掩盖了任何短暂的故障。
- 为实现这一目标，底层需要维护传输的数据包数量、确认的数据包数量或未完成的流控制权限的数量，且确保不会发生丢失上述信息的中断。
- 防止底层数据丢失可采取复制，命运共享的方式。复制由于其分布式性质，确保健壮复制的算法很难构建，具有分布式状态信息的网络，很少能够提供任何类型的故障保护。这里详述命运共享。
- 命运共享则具有两大优势：能防止任意数量的中间故障，而复制只能防止一定数量的故障(小于复制副本的数量)；其次，实现上容易得多。
- 命运共享方法有两个后果：首先，分组交换节点(或网关)不能有任何正在进行的连接的基本状态信息，它们是无状态分组交换机，这类网络设计有时被称为“数据报”网络。其次，更多的信任放在主机上，而不是放在网络确保可靠传递的架构上。如果确保数据排序和确认的主机驻留算法失败，则该机器上的应用程序将无法运行。
- 尽管生存能力是列表中的第一个目标，但它仍然次于现有网络互连的最高目标。单一的多媒体网络设计可能会产生一种生存能力更强的技术。
4. 服务类型
- Internet体系结构的第二个目标是在传输层支持各种类型的服务。不同类型的服务通过对速度、延迟和可靠性等方面的不同要求来区分。传统的服务类型是双向可靠的数据交付，有时被称为“虚拟电路”服务，适用于远程登录或文件传输等应用程序，其中远程登录需要低延迟交付服务，但对带宽的要求很低，而文件传输则不太关心延迟，但非常关心高吞吐量，TCP同时提供两种类型服务。TCP最初追求足够通用，支持任何所需类型的服务。然而，随着服务的全部范围变得清晰，在一个协议支持所有服务似乎太困难了。
- *例如，TCP不支持实时数字化语音，因为实时传输没必要坚持每个字节按序交付，而且，信息包必须定期到达接收机，以便被转换回模拟信号。如果没有在预期的时间到达就不可能实时重新组装信号。网络中最严重的延迟来源是提供可靠交付的机制。典型的可靠传输协议通过请求重传并延迟任何后续数据包的发送来响应丢失的数据包，直到重新传输丢失的数据包。然后它按顺序传递该数据包和所有剩余的数据包。当这种情况发生时，延迟可能是网络往返交付时间的许多倍，并可能完全破坏语音重组算法。相反，它很容易处理偶尔丢失的数据包：缺失的语音用短时间的沉默代替。在大多数情况下，这并不影响听者对语音的理解。如果出现这种情况，就会发生高级别的纠错，听者可以要求说话者重复受损的短语。
- 因此，在Internet体系结构发展的相当早期，就决定需要多个传输服务，同时承受限制可靠性、延迟或带宽的传输。这一目标导致TCP，IP分为两层，TCP提供可靠的有序数据流，而IP试图提供一个基本的构建块（数据包）构建各种服务。事实证明，在没有底层网络的明确支持的情况下提供多种类型的服务比最初希望的要困难得多，特定的网络设计不够灵活，无法支持其他服务。最常见的是，网络在设计时假定它应该提供可靠的服务，并且将延迟作为提供可靠服务的一部分，无论是否需要这种可靠性。
5. 网络的种类
- ^互联网架构的成功非常重要，因为它能够融合和利用各种各样的网络技术，包括军事和商业设施。互联网架构在实现这一目标方面非常成功;它在各种各样的网络上运行，包括长途网络(阿帕网本身和各种X.25网络)、局域网(以太网、ringnet等)、广播卫星网络(DARPA大西洋卫星网络14、15以每秒64千比特的速度运行，DARPA实验宽带卫星网络16在美国境内以每秒3兆比特的速度运行)、分组无线网络(DARPA分组无线网络、以及一个实验性的英国分组无线网络和一个由业余无线电操作员开发的网络)，各种串行链路，范围从1200 ACM SIGCOMM -5-计算机通信审查比特每秒异步连接到T1链路，以及各种其他临时设施，包括计算机间总线和其他网络套件(如IBM的HASP)的高级层提供的传输服务。
- 有许多服务没有明确地从网络中假设。这些包括可靠的或有序的传递、网络级广播或组播、传输数据包的优先级排序、对多种类型服务的支持以及对故障、速度或延迟的内部知识。如果需要这些服务，那么为了适应Internet中的网络，就需要网络直接支持这些服务，或者网络接口软件提供增强功能，以在网络端点模拟这些服务。有人认为这是一种不可取的方法，因为必须为每个网络以及每个网络的每个主机接口重新设计和实现这些服务。通过在传输过程中设计这些服务，例如通过TCP进行可靠的交付，工程只需要完成一次，并且每个主机的实现也只需要完成一次。在此之后，新网络接口软件的实现通常非常简单。
6. 其他目标 
- 对因特网进行分布式管理的目标在某些方面已经实现了。例如，因特网中有几个不同的管理中心，每个中心操作网关的一个子集，并且有一个两层路由算法，允许来自不同管理中心的网关交换路由表，即使它们彼此不完全信任，并且在单个管理中心的网关之间使用各种私有路由算法。类似地，管理网关的各种组织不一定是管理网关所连接的网络的同一组织。然而路由方面缺少足够分布式管理工具，需手动设路由表，容易出错且不强大。
- 数据包1000可靠字节40头部字节，短数据包相对于1000字节大包，后者开销4%而前者可能较大。丢失数据包重传也是低效原因之一，数据包可能二次穿过几个中间网络。但是在重传率足够低的情况下可以容忍（粗略估计，1%合理，10%应该对网络添加可靠性增强）
- ^主机连接Internet成本可能比在其他体系结构中要高一些，因为提供所需服务类型的所有机制，例如确认和重传ACM SIGCOMM -6-计算机通信审查策略，都必须在主机中而不是在网络中实现。最初，对于不熟悉协议实现的程序员来说，这样做似乎有点令人生畏。实现者尝试了诸如将传输协议移动到前端处理器等事情，他们的想法是协议只实现一次，而不是针对每种类型的主机再次实现。然而，这需要发明一个主机前端协议，有些人认为实现起来几乎和原来的传输协议一样复杂。随着协议经验的增加，与在主机中实现协议套件相关的焦虑似乎正在减少，现在可以在各种机器上实现协议套件，包括个人计算机和其他计算资源非常有限的机器。
7. 架构和实现
- 因特网架构尝试不限制服务范围。因而理解因特网不能关注架构，而必须关注特定主机和网关内软件的实际工程，以及已被合并的特定网络。
- 因特网一些实现以ms为单位，另一些以s为单位，某些应用程序(如实时语音)在这两种实现之间的工作方式有着根本不同，一些互联网被设计成网关和路径有很大的冗余。可生存的互联网存在故障后重新配置的资源。其他互联网为了降低成本，通过实现有单点连接，一个故障可能把它分成两部分。
- ** Internet体系结构通过设计来容忍这种实现的多样性。然而，它给特定实现的设计者留下了大量的工程工作要做。这种架构开发的主要斗争之一是理解如何为实现的设计者提供指导，这种指导将实现的工程与将产生的服务类型联系起来。例如，设计师必须回答以下问题。如果整个服务要交付某个速率的吞吐量，底层网络中必须有什么样的带宽?给定这个实现中可能出现的故障的某个模型，应该在实现中设计什么样的冗余?大多数已知的网络设计辅助工具似乎对回答这类问题没有帮助。 
  - 例如，协议验证器帮助确认协议符合规范。然而，这些工具几乎从不处理性能问题，而性能问题对于服务类型的思想是至关重要的。相反，它们处理的是协议在规范方面的逻辑正确性这个更受限制的思想。虽然用于验证逻辑正确性的工具在规范和实现阶段都很有用，但它们不能帮助解决经常出现的与性能相关的严重问题。一个典型的实现经验是，即使在证明了逻辑正确性之后，也会发现可能导致一个数量级性能下降的设计错误。对这个问题的研究得出的结论是，困难通常不是在协议本身，而是在协议运行的操作系统上。在这种情况下，很难在ACM SIGCOMM -7-计算机通信评审体系结构规范的上下文中解决这个问题。然而，我们仍然强烈地感到有必要给予实现者指导。今天我们仍在与这个问题作斗争。
  - 另一类设计辅助是模拟器，它采用特定的实现，并探索它在各种负载下可以交付的服务。还没有人尝试构造一个模拟器，它考虑到网关实现、主机实现和在可能的Internet实现中看到的网络性能的广泛可变性。因此，大多数互联网实现的分析都是在信封的背面完成的。这是对互联网架构的目标结构的评论，如果由一个足够有知识的人完成，一个信封的背面分析通常就足够了。特定Internet实现的设计人员通常不太关心获得最后5%的可能的线路利用率，而是知道在给定当前手头的资源的情况下是否可以实现所需的服务类型。
  - 架构和性能之间的关系是一个极具挑战性的关系。互联网架构设计者在将体系结构中的性能约束形式化方面遇到了很大的困难：一方面是因为体系结构的目标不是限制性能，而是允许可变性，另一方面(也许是更根本的原因)是因为似乎没有有用的形式化工具来描述性能。这个问题尤其严重，因为互联网项目的目标是产生规范文件，这些文件将成为军事标准。这是政府承包的一个众所周知的问题，人们不能期望承包商满足任何不属于采购标准的标准。因此，如果互联网关注的是性能，则必须将性能要求纳入采购规范。发明限制性能的规范是微不足道的，例如指定实现必须能够每秒传递1000个数据包。然而，这种类型的约束不能成为体系结构的一部分，因此要由执行采购的个人来认识到这些性能约束必须添加到规范中，并正确地指定它们以实现提供所需类型的服务。我们不知道如何在架构中为执行这项任务的人提供指导。
8. 数据报
- 因特网以数据报作为实体传输。首先，它们消除了中间交换节点对连接状态的需求，这意味着在故障发生后，可以在不考虑状态的情况下重新构建Internet。其次，数据报提供了一个基本的构建块，在此基础上可以实现各种类型的服务。与虚拟电路(通常意味着固定类型的服务)相比，数据报提供了更基本的服务，端点可以将其适当组合以构建所需的服务类型。第三，数据报代表了最小的网络服务假设，允许将各种各样的网络合并到各种Internet实现中。使用数据报的决定是一个非常成功的决定，这使得互联网非常成功地实现了它最重要的目标。
- 有一个与数据报相关的错误假设，即数据报的动机是对本质上等同于数据报的更高级别服务的支持。换句话说，有时建议提供数据报，因为应用程序所需的传输服务是数据报服务。事实上，这种情况很少发生。虽然Internet上的一些应用程序(例如对日期服务器或名称服务器的简单查询)使用基于不可靠数据报的访问方法，但Internet中的大多数服务更喜欢更复杂的传输模型，而不是简单的数据报。有些服务希望增强可靠性，有些希望平滑和缓冲延迟，但几乎所有服务都有一些比数据报更复杂的期望。重要的是要理解数据报在这方面的作用是作为构建块，而不是作为服务本身。
9. TCP
- $ TCP在成为标准之前经历了几个主要版本。
  - 最初的ARPANET主机到主机协议提供了基于字节和数据包的流量控制。这似乎过于复杂，TCP的设计者认为只有一种形式的监管就足够了。选择是规范字节的传递，而不是数据包。因此，TCP中的流控制和确认是基于字节数而不是数据包数。实际上，在TCP中，数据的分组化是没有意义的。 这一决定是出于若干考虑，其中一些考虑无关紧要，而另一些考虑比预期的更重要。确认字节的一个原因是允许在字节的序列空间中插入控制信息，这样就可以确认控制和数据。这种序列空间的使用被放弃了，取而代之的是处理每个控制消息的特别技术。虽然最初的想法具有吸引力的普遍性，但它在实践中造成了复杂性。
  - 字节流的第二个原因是允许TCP包在必要时被分解成更小的包，以便通过一个小包大小的网络。但是当IP从TCP中分离出来时，这个功能被转移到了IP层，IP被迫发明了一种不同的碎片化方法。
  - **确认字节而不是数据包的第三个原因是，如果需要重新传输数据，允许在发送主机中将许多小包聚集在一起成为一个较大的数据包。目前尚不清楚这种优势是否重要;事实证明，这是至关重要的。UNIX等具有基于单个字符交互的内部通信模型的系统通常会发送许多包含一个字节数据的数据包。(有人可能会从网络的角度认为这种行为很愚蠢，但这是现实，是交互式远程登录的必要条件。)人们经常观察到，这样的主机可以用一个字节的数据产生大量的数据包，这些数据包到达的速度要比慢速主机处理它们的速度快得多。结果是丢包和重传。
    - 如果重传的是原始数据包，那么在每次重传时都将重复同样的问题，从而对性能造成无法容忍的影响，从而阻止操作。但是由于字节被收集到一个数据包中进行重传，重传以一种更有效的方式发生，从而允许实际操作。另一方面，字节的确认可以被视为首先造成这个问题的原因。如果流量控制的基础是数据包而不是字节，那么这种洪泛可能永远不会发生。但是，如果发送的是小包，则包级别的控制会对吞吐量提供严格的限制：实际接收的数据报，数据量可能相差1000倍，这取决于发送主机在每个数据包中放入的字节是1个还是1000个。回顾过去，正确的设计决策可能是，如果TCP要提供对各种服务的有效支持，就必须像最初的ARPANET协议那样，对数据包和字节都进行监管。
    - 与字节流相关的另一个设计决策是字母结束标志，或EOL。现在它已经从协议中消失了，取而代之的是Push标志或PSH。EOL最初的想法是将字节流分解成记录。它是通过将来自不同记录的数据放入不同的数据包来实现的，这与重新传输时组合数据包的想法不兼容。因此，EOL的语义被更改为一种较弱的形式，仅意味着到目前为止流中的数据是一个或多个完整的应用程序级元素，这将导致TCP或网络中的任何内部缓冲刷新。通过说“一个或多个”而不是“恰好一个”，可以将几个组合在一起，并保持在重组中压缩数据的目标。但是较弱的语义意味着各种应用程序必须发明一种特别的机制来在数据流之上划分记录。在EOL语义的演变过程中，有一种鲜为人知的中间形式，这引起了很大的争论。根据主机的缓冲策略，TCP的字节流模型可能在一种不太可能的情况下造成很大的问题。考虑这样一个主机，其中传入的数据被放入一个固定大小的缓冲区序列中。缓冲区被填满时返回给用户，或者接收到EOL。现在考虑一个无序包到达的情况，它的无序程度超过了当前缓冲区。现在进一步考虑，在接收到这个乱序数据包后，一个带有EOL的数据包导致当前缓冲区只部分满地返回给用户。这个特定的操作序列会导致下一个缓冲区中的无序数据位于错误的位置，因为缓冲区中的空字节返回给用户。处理这一问题在主机中产生了簿记问题，这似乎是不必要的。为了解决这个问题，有人提出EOL应该“用完”所有的序列空间，直到下一个值，即缓冲区大小为零。换句话说，提出EOL应该是一种将字节流映射到主机缓冲区管理的工具。

10. 结论
 - 互联网架构是非常成功的。这些协议在商业和军事环境中广泛使用，并产生了许多类似的体系结构。与此同时，它的成功也清楚地表明，在某些情况下，设计师的优先级与实际用户的需求并不匹配。需要更多地注意会计、资源管理和有单独行政机构的区域的运作等问题。虽然数据报在解决Internet最重要的目标方面发挥了很好的作用，但当我们试图解决一些排在优先级列表后面的目标时，它的作用就不那么好了。例如，在数据报的情况下，资源管理和责任制的目标已证明难以实现。正如前一节所讨论的，大多数数据报是从源到目的地的某个数据包序列的一部分，而不是应用程序级别的孤立单元。然而，网关不能直接看到这个序列的存在，因为它被迫孤立地处理每个数据包。因此，必须对每个数据包分别进行资源管理决策或记帐。将数据报模型强加于互联网层已经剥夺了该层可以用来实现这些目标的重要信息来源。这表明，对于下一代体系结构，可能存在比数据报更好的构建块。此构建块的一般特征是，它将标识从源到目的地的数据包序列，而不假设该服务具有任何特定类型的服务。我用“流”这个词来描述这个构建块。为了记住通过它们的流的性质，网关有必要具有流状态，但是状态信息对于维护与流关联的所需服务类型并不重要。相反，该类型的服务将由端点强制执行，端点将定期发送消息以确保正确的服务类型与流关联。通过这种方式，与流关联的状态信息可能会在崩溃中丢失，而不会永久地中断所使用的服务功能。我把这个概念称为“软状态”，它很可能允许我们实现生存性和灵活性的主要目标，同时更好地处理资源管理和问责制问题。探索替代构建模块是DARPA互联网项目目前的研究方向之一。



### A Brief History of the Internet (综述历史性)
#### 简单梳理下时间线，每句话都不冗余。 

### END-TO-END ARGUMENTS IN SYSTEM DESIGN 

### 